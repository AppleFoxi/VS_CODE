local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer

-- –ñ–¥–µ–º –ø–æ–∫–∞ –∏–≥—Ä–æ–∫ –∑–∞—Å–ø–∞–≤–Ω–∏—Ç—Å—è
print("‚è≥ –û–∂–∏–¥–∞–µ–º —Å–ø–∞–≤–Ω–∞ –∏–≥—Ä–æ–∫–∞...")
while not player.Character do
    RunService.Heartbeat:Wait()
end
print("‚úÖ –ò–≥—Ä–æ–∫ –∑–∞—Å–ø–∞–≤–Ω–∏–ª—Å—è")

local playerGui = player:WaitForChild("PlayerGui")
print("‚úÖ PlayerGui –∑–∞–≥—Ä—É–∂–µ–Ω")

local ShopUIEvent = ReplicatedStorage:FindFirstChild("ShopUIEvent")

-- –ñ–¥–µ–º —Å–æ–∑–¥–∞–Ω–∏—è RemoteEvent
if not ShopUIEvent then
    wait(2)
    ShopUIEvent = ReplicatedStorage:WaitForChild("ShopUIEvent")
end

-- –ù–∞—Ö–æ–¥–∏–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ—Ä–µ–π–º –º–∞–≥–∞–∑–∏–Ω–∞ –≤ PlayerGui
local function findShopFrame()
    -- –î–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ GUI –∏–∑ StarterGui
    wait(1)
    
    -- –ò—â–µ–º –≤ PlayerGui (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è –∫–æ–ø–∏—è –∫–æ—Ç–æ—Ä—É—é –≤–∏–¥–∏—Ç –∏–≥—Ä–æ–∫)
    for _, gui in ipairs(playerGui:GetChildren()) do
        if gui:IsA("ScreenGui") then
            for _, child in ipairs(gui:GetChildren()) do
                if child:IsA("Frame") then
                    print("‚úÖ –ù–∞–π–¥–µ–Ω —Ñ—Ä–µ–π–º –≤ PlayerGui: " .. child.Name)
                    return child
                end
            end
        end
    end
    warn("‚ùå –§—Ä–µ–π–º –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ PlayerGui")
    return nil
end

-- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–π –¥–ª—è —Ñ—Ä–µ–π–º–∞
local function setupShopAnimations(shopFrame)
    -- –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    local originalSize = shopFrame.Size
    local originalPosition = shopFrame.Position
    local originalAnchorPoint = shopFrame.AnchorPoint or Vector2.new(0, 0)
    
    print("üîÑ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–π –¥–ª—è —Ñ—Ä–µ–π–º–∞...")
    
    -- –§—É–Ω–∫—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–∞–≥–∞–∑–∏–Ω–∞
  local function openShop()
    if shopFrame.Visible then return false end
    
    shopFrame.Visible = true
    shopFrame.Size = UDim2.new(0, 10, 0, 10)
    shopFrame.Position = UDim2.new(
        originalPosition.X.Scale, 
        originalPosition.X.Offset + originalSize.X.Offset/2 - 5,
        originalPosition.Y.Scale,
        originalPosition.Y.Offset + originalSize.Y.Offset/2 - 5
    )
    
    local tween = TweenService:Create(shopFrame, TweenInfo.new(0.3), {
        Size = originalSize,
        Position = originalPosition
    })
    tween:Play()
    
    return true
end
    
    -- –§—É–Ω–∫—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–∞–≥–∞–∑–∏–Ω–∞
    local function closeShop()
        if not shopFrame.Visible then
            return false
        end
        
        local tweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Back, Enum.EasingDirection.In)
        
        local sizeTween = TweenService:Create(shopFrame, tweenInfo, {
            Size = UDim2.new(0, 10, 0, 10)
        })
        
        local positionTween = TweenService:Create(shopFrame, tweenInfo, {
            Position = UDim2.new(0.5, 0, 0.5, 0)
        })
        
        sizeTween:Play()
        positionTween:Play()
        
        sizeTween.Completed:Connect(function()
            shopFrame.Visible = false
            shopFrame.Size = originalSize
            shopFrame.Position = originalPosition
            shopFrame.AnchorPoint = originalAnchorPoint
            print("üîí –§—Ä–µ–π–º –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫—Ä—ã—Ç")
        end)
        
        print("üõí –ú–∞–≥–∞–∑–∏–Ω –ó–ê–ö–†–´–¢")
        return true
    end
    
    -- –°—Ä–∞–∑—É –∑–∞–∫—Ä—ã–≤–∞–µ–º —Ñ—Ä–µ–π–º –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
    print("üö™ –ó–∞–∫—Ä—ã–≤–∞–µ–º —Ñ—Ä–µ–π–º –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ...")
    shopFrame.Visible = false
    shopFrame.Size = originalSize
    shopFrame.Position = originalPosition
    shopFrame.AnchorPoint = originalAnchorPoint
    
    return {
        open = openShop,
        close = closeShop
    }
end

-- –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ (–ø–æ—Å–ª–µ —Å–ø–∞–≤–Ω–∞ –∏–≥—Ä–æ–∫–∞)
local shopFrame = findShopFrame()
local shopAnimations = nil
local isShopOpen = false

if shopFrame then
    print("‚úÖ –§—Ä–µ–π–º –Ω–∞–π–¥–µ–Ω, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏...")
    shopAnimations = setupShopAnimations(shopFrame)
    print("üéâ –ê–Ω–∏–º–∞—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!")
else
    warn("‚ö†Ô∏è –ú–∞–≥–∞–∑–∏–Ω –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å - —Ñ—Ä–µ–π–º –Ω–µ –Ω–∞–π–¥–µ–Ω")
    return
end

-- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
ShopUIEvent.OnClientEvent:Connect(function(action, data)
    if not shopAnimations then return end
    
    if action == "toggleShop" then
        if data.isOpen and not isShopOpen then
            local success = shopAnimations.open()
            if success then
                isShopOpen = true
            end
        elseif not data.isOpen and isShopOpen then
            local success = shopAnimations.close()
            if success then
                isShopOpen = false
            end
        end
    end
end)

-- –ü–æ–∏—Å–∫ ShopBlock –≤ Workspace
local function findShopBlock()
    return workspace:FindFirstChild("ShopBlock")
end

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –¥–æ ShopBlock
local function checkShopDistance()
    local character = player.Character
    local shopBlock = findShopBlock()
    
    if not character or not shopBlock then 
        return false 
    end
    
    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return false end
    
    local distance = (humanoidRootPart.Position - shopBlock.Position).Magnitude
    return distance <= 15
end

-- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏
local lastCheckResult = false
local debounce = false

RunService.Heartbeat:Connect(function()
    if not shopAnimations or debounce then return end
    debounce = true
    
    local isInRange = checkShopDistance()
    
    if isInRange and not lastCheckResult then
        ShopUIEvent:FireServer("openShop")
        lastCheckResult = true
    elseif not isInRange and lastCheckResult then
        ShopUIEvent:FireServer("closeShop")
        lastCheckResult = false
    end
    
    debounce = false
end)

print("üéä –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–∞–≥–∞–∑–∏–Ω–∞ –ó–ê–ü–£–©–ï–ù–ê!")