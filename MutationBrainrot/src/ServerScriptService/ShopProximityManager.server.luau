local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

-- –°–æ–∑–¥–∞–µ–º RemoteEvent –¥–ª—è UI
local ShopUIEvent = Instance.new("RemoteEvent")
ShopUIEvent.Name = "ShopUIEvent"
ShopUIEvent.Parent = ReplicatedStorage

print("‚úÖ ShopUIEvent —Å–æ–∑–¥–∞–Ω")

-- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç–∫—Ä—ã—Ç–∏—è/–∑–∞–∫—Ä—ã—Ç–∏—è
ShopUIEvent.OnServerEvent:Connect(function(player, action)
    if action == "openShop" then
        ShopUIEvent:FireClient(player, "toggleShop", {isOpen = true})
        print("üõí " .. player.Name .. " –æ—Ç–∫—Ä—ã–ª –º–∞–≥–∞–∑–∏–Ω")
    elseif action == "closeShop" then
        ShopUIEvent:FireClient(player, "toggleShop", {isOpen = false})
        print("üõí " .. player.Name .. " –∑–∞–∫—Ä—ã–ª –º–∞–≥–∞–∑–∏–Ω")
    end
end)

-- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
local function setupShopBlock()
    local shopBlock = workspace:FindFirstChild("ShopBlock")
    
    if not shopBlock then
        -- –°–æ–∑–¥–∞–µ–º ShopBlock –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω
        shopBlock = Instance.new("Part")
        shopBlock.Name = "ShopBlock"
        shopBlock.Size = Vector3.new(10, 10, 10)
        shopBlock.Position = Vector3.new(0, 5, 0)
        shopBlock.Anchored = true
        shopBlock.BrickColor = BrickColor.new("Bright yellow")
        shopBlock.Material = Enum.Material.Neon
        shopBlock.Parent = workspace
        print("‚úÖ ShopBlock —Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏")
    else
        print("‚úÖ ShopBlock –Ω–∞–π–¥–µ–Ω")
    end
    
    return shopBlock
end

local shopBlock = setupShopBlock()
local playersNearShop = {}

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
RunService.Heartbeat:Connect(function()
    for _, player in ipairs(Players:GetPlayers()) do
        local character = player.Character
        if character and character:FindFirstChild("HumanoidRootPart") then
            local distance = (character.HumanoidRootPart.Position - shopBlock.Position).Magnitude
            local isInRange = distance <= 15
            
            if isInRange and not playersNearShop[player] then
                playersNearShop[player] = true
                ShopUIEvent:FireClient(player, "toggleShop", {isOpen = true})
            elseif not isInRange and playersNearShop[player] then
                playersNearShop[player] = nil
                ShopUIEvent:FireClient(player, "toggleShop", {isOpen = false})
            end
        end
    end
end)

print("‚úÖ –°–µ—Ä–≤–µ—Ä–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞–≥–∞–∑–∏–Ω–æ–º –≥–æ—Ç–æ–≤–∞!")