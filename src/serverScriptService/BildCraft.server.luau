-- BuildServer (Script –≤ ServerScriptService)
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local DataStoreService = game:GetService("DataStoreService")
local remoteEvent = ReplicatedStorage:WaitForChild("BuildBlockEvent")
local inventoryEvent = ReplicatedStorage:WaitForChild("InventoryEvent")

-- –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
local playerData = {}
local inventoryStore = DataStoreService:GetDataStore("PlayerInventory")

-- –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –∏–≥—Ä–æ–∫–∞
local function loadPlayerInventory(player)
    playerData[player] = {
        Stone = 10,
        Wood = 25,
        Glass = 5,
        Metal = 2,
        Brick = 15,
        Gold = 1
    }
    
    -- –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç
    inventoryEvent:FireClient(player, "initInventory", playerData[player])
end


-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –µ—Å—Ç—å –ª–∏ —É –∏–≥—Ä–æ–∫–∞ –ø—Ä–µ–¥–º–µ—Ç
local function hasItem(player, itemName, amount)
    amount = amount or 1
    return playerData[player] and playerData[player][itemName] and playerData[player][itemName] >= amount
end

-- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞
local function useItem(player, itemName, amount)
    amount = amount or 1
    if hasItem(player, itemName, amount) then
        playerData[player][itemName] = playerData[player][itemName] - amount
        inventoryEvent:FireClient(player, "itemUsed", itemName, playerData[player][itemName])
        return true
    end
    return false
end

-- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏–π –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
inventoryEvent.OnServerEvent:Connect(function(player, action, itemName)
    if action == "selectItem" then
        if hasItem(player, itemName) then
            inventoryEvent:FireClient(player, "itemSelected", itemName, playerData[player][itemName])
        else
            inventoryEvent:FireClient(player, "error", "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ " .. itemName)
        end
    elseif action == "checkItem" then
        return hasItem(player, itemName)
    end
end)

-- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞
remoteEvent.OnServerEvent:Connect(function(player, action, blockType, position)
    if action == "buildBlock" then
        -- –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —É –∏–≥—Ä–æ–∫–∞ –Ω—É–∂–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç
        if hasItem(player, blockType, 1) then
            -- –°–æ–∑–¥–∞–µ–º –±–ª–æ–∫
            local newBlock = Instance.new("Part")
            newBlock.Size = Vector3.new(4, 4, 4)
            newBlock.Position = position
            newBlock.Anchored = true
            newBlock.CanCollide = true
            
            -- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª –∏ —Ü–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
            if blockType == "Stone" then
                newBlock.Material = Enum.Material.Slate
                newBlock.Color = Color3.fromRGB(120, 120, 120)
            elseif blockType == "Wood" then
                newBlock.Material = Enum.Material.Wood
                newBlock.Color = Color3.fromRGB(139, 69, 19)
            elseif blockType == "Glass" then
                newBlock.Material = Enum.Material.Glass
                newBlock.Transparency = 0.3
            elseif blockType == "Metal" then
                newBlock.Material = Enum.Material.Metal
                newBlock.Color = Color3.fromRGB(200, 200, 200)
            elseif blockType == "Brick" then
                newBlock.Material = Enum.Material.Brick
                newBlock.Color = Color3.fromRGB(150, 100, 100)
            elseif blockType == "Gold" then
                newBlock.Material = Enum.Material.Neon
                newBlock.Color = Color3.fromRGB(255, 215, 0)
            end
            
            newBlock.Parent = workspace
            
            -- –£–º–µ–Ω—å—à–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
            useItem(player, blockType, 1)
            
            print("‚úÖ –ò–≥—Ä–æ–∫ " .. player.Name .. " –ø–æ—Å—Ç—Ä–æ–∏–ª –±–ª–æ–∫: " .. blockType)
        else
            inventoryEvent:FireClient(player, "error", "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ " .. blockType)
            print("‚ùå –£ –∏–≥—Ä–æ–∫–∞ " .. player.Name .. " –Ω–µ—Ç –ø—Ä–µ–¥–º–µ—Ç–∞: " .. blockType)
        end
    end
end)

-- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞
game.Players.PlayerAdded:Connect(function(player)
    loadPlayerInventory(player)
    print("üì¶ –ó–∞–≥—Ä—É–∂–µ–Ω –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –¥–ª—è: " .. player.Name)
end)

-- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞
game.Players.PlayerRemoving:Connect(function(player)
    playerData[player] = nil
    print("üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –¥–ª—è: " .. player.Name)
end)

print("‚úÖ –°–µ—Ä–≤–µ—Ä–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ –∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –∑–∞–ø—É—â–µ–Ω")